/* =============================================================
   ACCESSIBILITY CSS — Panel + Modos WCAG 2.1
   Principio Perceptible, Operable y Robusto
============================================================= */

/* ============================================================
   WCAG 1.1.1 — Skip links
============================================================ */
.skip-link {
  position: absolute;
  top: -100%;
  left: var(--space-4);
  z-index: 9999;
  background: var(--color-primary);
  color: white;
  padding: var(--space-3) var(--space-6);
  border-radius: 0 0 var(--radius-md) var(--radius-md);
  font-weight: var(--font-semibold);
  font-size: var(--text-base);
  text-decoration: none;
  transition: top var(--transition-fast);
  box-shadow: var(--focus-ring);
}
.skip-link:focus { top: 0; outline: none; }

/* ============================================================
   WCAG 1.3.1 — Visually hidden
============================================================ */
.visually-hidden {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0,0,0,0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}
.visually-hidden:focus,
.visually-hidden:active {
  position: static !important;
  width: auto !important;
  height: auto !important;
  overflow: visible !important;
  clip: auto !important;
  white-space: normal !important;
}

/* ============================================================
   WCAG 2.4.7 — Foco visible
============================================================ */
:focus-visible {
  outline: 3px solid var(--color-primary);
  outline-offset: 3px;
}
:focus:not(:focus-visible) { outline: none; }

.site-footer a:focus-visible,
.site-footer button:focus-visible,
.hero a:focus-visible {
  outline-color: var(--color-accent);
  box-shadow: 0 0 0 3px var(--color-bg-dark), 0 0 0 5px var(--color-accent);
}

/* ============================================================
   WCAG 1.4.1 — Color + texto simultáneo
============================================================ */
.status::before { font-weight: var(--font-bold); margin-right: var(--space-1); }
a[aria-current="page"] {
  font-weight: var(--font-semibold);
  text-decoration: underline;
  text-decoration-thickness: 2px;
}

/* ============================================================
   WCAG 1.4.3 — Contraste placeholder
============================================================ */
input::placeholder,
textarea::placeholder { color: var(--color-text-muted); }

/* ============================================================
   WCAG 1.4.4 — Wrap para zoom 200%
============================================================ */
.product-name, .offer-name, .category-name, .hero-title, .section-title {
  overflow-wrap: break-word;
  hyphens: auto;
}

/* ============================================================
   WCAG 1.4.8 — Espaciado base
============================================================ */
p, li, th, td, dd { line-height: 1.6; letter-spacing: 0.01em; }

/* ============================================================
   WCAG 3.3 — Errores de formulario
============================================================ */
input:invalid { border-color: var(--color-error); border-style: solid; }
.field-error {
  color: var(--color-error);
  font-size: var(--text-sm);
  margin-top: var(--space-1);
  display: flex;
  align-items: center;
  gap: var(--space-2);
}
.field-error::before { content: '⚠'; font-size: 1em; }

/* ============================================================
   MEDIA
============================================================ */
video, audio { display: block; }

/* ============================================================
   Forced colors (alto contraste del sistema)
============================================================ */
@media (forced-colors: active) {
  .btn-primary, .btn-secondary, .btn-outline { forced-color-adjust: none; border: 2px solid ButtonText; }
  .badge { forced-color-adjust: none; border: 1px solid ButtonText; }
}

/* =============================================================
   PANEL DE ACCESIBILIDAD — FAB + Panel flotante
============================================================= */

/* --- FAB (botón flotante) --- */
.a11y-fab {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  z-index: 1100;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.65rem 1.1rem;
  background: var(--color-primary);
  color: #fff;
  border: none;
  border-radius: 2rem;
  font-family: var(--font-family);
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(0,0,0,0.22);
  transition: background var(--transition-fast), transform var(--transition-fast),
              box-shadow var(--transition-fast);
  min-height: 44px;
}
.a11y-fab:hover {
  background: var(--color-primary-light);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.28);
}
.a11y-fab:focus-visible {
  outline: 3px solid var(--color-accent);
  outline-offset: 3px;
}
.a11y-fab-label { white-space: nowrap; }

/* --- Panel --- */
.a11y-panel {
  position: fixed;
  bottom: 5rem;
  right: 1.5rem;
  z-index: 1099;
  width: 320px;
  max-width: calc(100vw - 2rem);
  max-height: calc(100vh - 7rem);
  overflow-y: auto;
  background: var(--color-bg);
  border: 1.5px solid var(--color-border);
  border-radius: var(--radius-xl);
  box-shadow: 0 20px 40px rgba(0,0,0,0.18);
  opacity: 0;
  transform: translateY(12px) scale(0.97);
  transition: opacity 0.2s ease, transform 0.2s ease;
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
}
.a11y-panel.is-open {
  opacity: 1;
  transform: translateY(0) scale(1);
}
.a11y-panel::-webkit-scrollbar { width: 4px; }
.a11y-panel::-webkit-scrollbar-thumb { background: var(--color-border); border-radius: 4px; }

/* Header del panel */
.a11y-panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.85rem 1rem 0.75rem;
  background: var(--color-primary);
  color: #fff;
  border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  position: sticky;
  top: 0;
  z-index: 2;
}
.a11y-panel-title {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-weight: var(--font-semibold);
  font-size: var(--text-base);
}
.a11y-panel-close {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px; height: 32px;
  background: rgba(255,255,255,0.15);
  color: #fff;
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: background var(--transition-fast);
}
.a11y-panel-close:hover  { background: rgba(255,255,255,0.28); }
.a11y-panel-close:focus-visible { outline: 2px solid #fff; outline-offset: 2px; }

/* Secciones */
.a11y-section {
  padding: 0.9rem 1rem;
  border-bottom: 1px solid var(--color-border);
}
.a11y-section:last-of-type { border-bottom: none; }

.a11y-section-title {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
  color: var(--color-text);
  margin: 0 0 0.4rem 0;
  line-height: 1.4;
}
.a11y-desc {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  margin: 0 0 0.6rem 0;
  max-width: none;
  line-height: 1.5;
}

/* --- Toggle switch --- */
.a11y-toggle {
  display: inline-flex;
  align-items: center;
  gap: 0.6rem;
  padding: 0.25rem 0.7rem 0.25rem 0.35rem;
  background: var(--color-bg-alt);
  border: 1.5px solid var(--color-border);
  border-radius: var(--radius-full);
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  color: var(--color-text-muted);
  min-height: 36px;
  transition: background var(--transition-fast), border-color var(--transition-fast),
              color var(--transition-fast);
}
.a11y-toggle.is-active {
  background: #dbeafe;
  border-color: var(--color-primary);
  color: var(--color-primary);
}
.a11y-toggle:focus-visible { outline: 2px solid var(--color-primary); outline-offset: 2px; }

.a11y-toggle-track {
  position: relative;
  width: 36px; height: 20px;
  background: var(--color-border);
  border-radius: var(--radius-full);
  flex-shrink: 0;
  transition: background var(--transition-fast);
}
.a11y-toggle-track::after {
  content: '';
  position: absolute;
  top: 3px; left: 3px;
  width: 14px; height: 14px;
  background: #fff;
  border-radius: 50%;
  box-shadow: 0 1px 4px rgba(0,0,0,0.2);
  transition: transform var(--transition-fast), background var(--transition-fast);
}
.a11y-toggle.is-active .a11y-toggle-track {
  background: var(--color-primary);
}
.a11y-toggle.is-active .a11y-toggle-track::after {
  transform: translateX(16px);
}

/* --- Font size stepper --- */
.a11y-font-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}
.a11y-stepper {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px; height: 36px;
  background: var(--color-bg-alt);
  border: 1.5px solid var(--color-border);
  border-radius: var(--radius-md);
  color: var(--color-text);
  cursor: pointer;
  font-size: 1.1rem;
  transition: background var(--transition-fast), border-color var(--transition-fast);
  flex-shrink: 0;
}
.a11y-stepper:hover:not(:disabled) {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: #fff;
}
.a11y-stepper:disabled { opacity: 0.4; cursor: not-allowed; }
.a11y-stepper:focus-visible { outline: 2px solid var(--color-primary); outline-offset: 2px; }
.a11y-font-val {
  flex: 1;
  text-align: center;
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  color: var(--color-text);
  white-space: nowrap;
}

/* --- Botones de contraste --- */
.a11y-contrast-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.4rem;
}
.a11y-contrast-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
  padding: 0.5rem 0.4rem;
  background: var(--color-bg-alt);
  border: 1.5px solid var(--color-border);
  border-radius: var(--radius-md);
  font-family: var(--font-family);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  color: var(--color-text-muted);
  cursor: pointer;
  transition: background var(--transition-fast), border-color var(--transition-fast),
              color var(--transition-fast);
  min-height: 56px;
}
.a11y-contrast-btn:hover {
  background: var(--color-bg);
  border-color: var(--color-primary);
  color: var(--color-primary);
}
.a11y-contrast-btn.is-active {
  background: #dbeafe;
  border-color: var(--color-primary);
  color: var(--color-primary);
  font-weight: var(--font-semibold);
}
.a11y-contrast-btn:focus-visible { outline: 2px solid var(--color-primary); outline-offset: 2px; }
.a11y-contrast-icon { font-size: 1.3rem; }

/* Footer del panel */
.a11y-panel-footer {
  padding: 0.75rem 1rem;
  background: var(--color-bg-alt);
  border-radius: 0 0 var(--radius-xl) var(--radius-xl);
}
.a11y-btn-reset {
  width: 100%;
  padding: 0.5rem;
  background: transparent;
  border: 1.5px solid var(--color-border);
  border-radius: var(--radius-md);
  font-family: var(--font-family);
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  color: var(--color-text-muted);
  cursor: pointer;
  transition: background var(--transition-fast), color var(--transition-fast),
              border-color var(--transition-fast);
  min-height: 40px;
}
.a11y-btn-reset:hover {
  background: #fee2e2;
  border-color: var(--color-error);
  color: var(--color-error);
}
.a11y-btn-reset:focus-visible { outline: 2px solid var(--color-primary); outline-offset: 2px; }

/* =============================================================
   MODOS DE ACCESIBILIDAD — Clases en <html>
============================================================= */

/* ---- ESPACIADO AMPLIADO ---- */
.a11y-spacing p,
.a11y-spacing li,
.a11y-spacing td,
.a11y-spacing th,
.a11y-spacing dd {
  line-height: 2 !important;
  letter-spacing: 0.05em !important;
  word-spacing: 0.1em !important;
}
.a11y-spacing p    { margin-bottom: 1.5rem !important; }
.a11y-spacing h1, .a11y-spacing h2, .a11y-spacing h3,
.a11y-spacing h4, .a11y-spacing h5, .a11y-spacing h6 {
  line-height: 1.6 !important;
  margin-bottom: 1rem !important;
}

/* ---- FUENTE DISLEXIA — Google Fonts cargada dinámicamente ---- */
/* Fallback: una fuente monospace de alto reconocimiento de letras */
.a11y-dyslexia body,
.a11y-dyslexia p,
.a11y-dyslexia li,
.a11y-dyslexia td,
.a11y-dyslexia th,
.a11y-dyslexia h1, .a11y-dyslexia h2, .a11y-dyslexia h3,
.a11y-dyslexia h4, .a11y-dyslexia h5, .a11y-dyslexia h6 {
  font-family: 'OpenDyslexic', 'Comic Sans MS', 'Trebuchet MS', Verdana, sans-serif !important;
  letter-spacing: 0.05em !important;
  word-spacing: 0.15em !important;
  line-height: 1.8 !important;
}

/* ---- RESALTAR ENLACES ---- */
.a11y-highlight-links a {
  background: #fffde7 !important;
  color: #0000cc !important;
  text-decoration: underline !important;
  text-decoration-thickness: 2px !important;
  text-underline-offset: 4px !important;
  padding: 0 2px !important;
  border-radius: 2px !important;
  outline: 1.5px solid #0000cc !important;
}
.a11y-highlight-links a:hover {
  background: #e3f2fd !important;
}

/* ---- CURSOR GRANDE ---- */
.a11y-big-cursor,
.a11y-big-cursor * {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Cpath d='M8 4L8 36L17 27L22 40L28 37L23 24L34 24Z' fill='black' stroke='white' stroke-width='2'/%3E%3C/svg%3E") 8 4, auto !important;
}
.a11y-big-cursor a,
.a11y-big-cursor button,
.a11y-big-cursor [role="button"],
.a11y-big-cursor input,
.a11y-big-cursor select,
.a11y-big-cursor textarea {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 48 48'%3E%3Ccircle cx='24' cy='24' r='18' fill='none' stroke='black' stroke-width='3'/%3E%3Ccircle cx='24' cy='24' r='6' fill='black'/%3E%3C/svg%3E") 24 24, pointer !important;
}

/* =============================================================
   MODOS DE CONTRASTE — data-contrast en <html>
============================================================= */

/* ---- ALTO CONTRASTE (blanco/negro) ---- */
[data-contrast="high"] {
  --color-bg:          #ffffff;
  --color-bg-alt:      #f0f0f0;
  --color-bg-dark:     #000000;
  --color-text:        #000000;
  --color-text-muted:  #1a1a1a;
  --color-text-white:  #ffffff;
  --color-primary:     #00008b;
  --color-primary-light: #0000cd;
  --color-primary-dark:  #00005a;
  --color-accent:      #cc7700;
  --color-accent-dark: #994400;
  --color-border:      #000000;
  --color-error:       #cc0000;
  --color-success:     #006600;
  --color-warning:     #884400;
}

[data-contrast="high"] *,
[data-contrast="high"] *::before,
[data-contrast="high"] *::after {
  border-color: #000 !important;
  box-shadow: none !important;
  text-shadow: none !important;
}

[data-contrast="high"] img {
  filter: contrast(1.2) saturate(0);
}

[data-contrast="high"] .hero-bg {
  background: #00008b !important;
}

[data-contrast="high"] :focus-visible {
  outline: 4px solid #000 !important;
  outline-offset: 4px !important;
  background: #ffff00 !important;
  color: #000 !important;
}

/* ---- MODO OSCURO ACCESIBLE ---- */
[data-contrast="dark"] {
  --color-bg:          #121212;
  --color-bg-alt:      #1e1e1e;
  --color-bg-dark:     #0a0a0a;
  --color-text:        #e8e8e8;
  --color-text-muted:  #aaaaaa;
  --color-text-white:  #ffffff;
  --color-primary:     #6ea8d8;
  --color-primary-light: #90c0eb;
  --color-primary-dark:  #3a7abc;
  --color-accent:      #f0b040;
  --color-accent-dark: #d09030;
  --color-border:      #3a3a3a;
  --color-error:       #f07070;
  --color-success:     #60c060;
  --color-warning:     #f0c050;
  --color-info:        #60a8e8;
}

[data-contrast="dark"] body { background: #121212; color: #e8e8e8; }
[data-contrast="dark"] img  { filter: brightness(0.88); }

[data-contrast="dark"] .hero-bg {
  background: linear-gradient(135deg, #0a0a0a 0%, #1a2a3a 60%, #0f1e2e 100%) !important;
}

[data-contrast="dark"] .announcement-bar {
  background: #2a2000;
  color: #f0c050;
}

[data-contrast="dark"] .site-footer {
  background: #0a0a0a;
}

[data-contrast="dark"] .compare-table thead th {
  background: #1a3050;
}

[data-contrast="dark"] .a11y-panel {
  background: #1e1e1e;
  border-color: #3a3a3a;
}
[data-contrast="dark"] .a11y-section { border-color: #3a3a3a; }
[data-contrast="dark"] .a11y-section-title { color: #e8e8e8; }
[data-contrast="dark"] .a11y-toggle { background: #2a2a2a; border-color: #4a4a4a; }
[data-contrast="dark"] .a11y-stepper { background: #2a2a2a; border-color: #4a4a4a; color: #e8e8e8; }
[data-contrast="dark"] .a11y-contrast-btn { background: #2a2a2a; border-color: #4a4a4a; color: #aaa; }
[data-contrast="dark"] .a11y-panel-footer { background: #181818; }
[data-contrast="dark"] .a11y-btn-reset { border-color: #4a4a4a; color: #aaa; }

/* ---- MODO INVERTIDO ---- */
[data-contrast="invert"] {
  filter: invert(1) hue-rotate(180deg);
}
[data-contrast="invert"] img,
[data-contrast="invert"] video {
  filter: invert(1) hue-rotate(180deg);
}

/* =============================================================
   TOOLTIP ACCESIBLE
============================================================= */
.tooltip-popup {
  position: absolute;
  z-index: 9000;
  background: var(--color-bg-dark);
  color: var(--color-text-white);
  font-size: var(--text-xs);
  padding: 0.35rem 0.65rem;
  border-radius: var(--radius-md);
  max-width: 220px;
  pointer-events: none;
  opacity: 0;
  transform: translateY(4px);
  transition: opacity var(--transition-fast), transform var(--transition-fast);
  white-space: normal;
  word-break: break-word;
}
.tooltip-popup.is-visible {
  opacity: 1;
  transform: translateY(0);
}

/* =============================================================
   RESPONSIVE — Panel en móvil
============================================================= */
@media (max-width: 480px) {
  .a11y-panel {
    bottom: 4.5rem;
    right: 0.75rem;
    left: 0.75rem;
    width: auto;
    max-width: none;
  }
  .a11y-fab {
    right: 0.75rem;
    bottom: 1rem;
  }
  .a11y-fab-label { display: none; }
  .a11y-fab { padding: 0.75rem; border-radius: 50%; }
}